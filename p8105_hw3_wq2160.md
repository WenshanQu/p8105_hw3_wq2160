p8105\_hw3\_wq2160
================
Wenshan Qu (wq2160)
10/18/2021

Initial Display Settings

``` r
knitr::opts_chunk$set(
  fig.width = 8,
  fig.asp = .6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

## Problem 1

load the `instacart` data.

``` r
library(p8105.datasets)
data("instacart")
```

**Description**

This data set contains `nrow(distinct(instacart, order_id))` orders
information, with `nrow(instacart)` rows and `ncol(instacart)` columns.
The key variables in this data set including `names(instacart)`.

To give a simple example on how to illustrate this chart, we could take
the `ins_eg = filter(instacart, order_id == "1")`. For this order,
number of `nrow(ins_eg)` items was purchased, with item names
`pull(ins_eg, product_name)` and item id `pull(ins_eg, product_id)`. For
these items, the aisle\_id, department\_id and aisle name were provided
to locate the product. Also, we can get the information fo the customer
purchase behavior, such as the order these items were added to the cart,
purchase time, times and intervals of reordering each item.

**1.1 Aisle information**

``` r
instacart %>% 
  count(aisle) %>% 
    arrange(desc(n))
```

    ## # A tibble: 134 × 2
    ##    aisle                              n
    ##    <chr>                          <int>
    ##  1 fresh vegetables              150609
    ##  2 fresh fruits                  150473
    ##  3 packaged vegetables fruits     78493
    ##  4 yogurt                         55240
    ##  5 packaged cheese                41699
    ##  6 water seltzer sparkling water  36617
    ##  7 milk                           32644
    ##  8 chips pretzels                 31269
    ##  9 soy lactosefree                26240
    ## 10 bread                          23635
    ## # … with 124 more rows

There are 134 aisles, and the most items are ordered from the **fresh
vegetables** aisle. “fresh fruits”, “packaged vegetables fruits” and
“yogurt” are also popular aisles.

**1.2 Aisle plot**

``` r
instacart %>% 
  count(aisle) %>% 
  filter(n > 10000) %>% 
  mutate(
    aisle = factor(aisle),
    aisle = fct_reorder(aisle, n)
  ) %>% 
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  theme(axis.text.x = element_text(angle = 90)) +
  labs(
    title = "Number of items ordered in each aisle",
    x = "Aisle",
    y = "Number of items"
  )
```

<img src="p8105_hw3_wq2160_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />

**1.3 Popular product in aisles**

``` r
aisle_df = 
  instacart %>% 
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) %>% 
  group_by(aisle) %>% 
  count(product_name) %>% 
  arrange(aisle, desc(n)) %>% 
  filter(row_number() == 1) %>% 
  rename(most_popular_product = product_name, ordered_times = n) %>% 
  knitr::kable(digits = 2)

aisle_df
```

| aisle                      | most\_popular\_product                        | ordered\_times |
|:---------------------------|:----------------------------------------------|---------------:|
| baking ingredients         | Light Brown Sugar                             |            499 |
| dog food care              | Snack Sticks Chicken & Rice Recipe Dog Treats |             30 |
| packaged vegetables fruits | Organic Baby Spinach                          |           9784 |

**1.4 Product and day**

``` r
day_df = 
  instacart %>% 
  filter(product_name %in% c("Pink Lady Apples", "Coffee Ice Cream")) %>% 
  group_by(product_name, order_dow) %>% 
  summarize(
    mean_hour = mean(order_hour_of_day)
  ) %>% 
  mutate(
    order_dow = recode(order_dow, "0" = "Sunday", "1" = "Monday", "2" = "Tuesday", "3" = "Wednesday", "4" = "Thursday", "5" = "Friday", "6" = "Saturday")
  ) %>% 
  pivot_wider(
    names_from = "order_dow",
    values_from = "mean_hour"
  ) %>% 
  knitr::kable(digits = 2)
```

    ## `summarise()` has grouped output by 'product_name'. You can override using the `.groups` argument.

``` r
day_df
```

| product\_name    | Sunday | Monday | Tuesday | Wednesday | Thursday | Friday | Saturday |
|:-----------------|-------:|-------:|--------:|----------:|---------:|-------:|---------:|
| Coffee Ice Cream |  13.77 |  14.32 |   15.38 |     15.32 |    15.22 |  12.26 |    13.83 |
| Pink Lady Apples |  13.44 |  11.36 |   11.70 |     14.25 |    11.55 |  12.78 |    11.94 |
